---
- name: Get information about the distribution
  tags: distribution_info, cloudwatch_agent
  block:
    - name: Get the distribution details
      ansible.builtin.setup:
        filter:
          - "ansible_distribution"
          - "ansible_distribution_major_version"

    - name: Print the distriburion version
      ansible.builtin.debug:
        msg: "The version is {{ ansible_distribution_major_version }}"

- name: Create wsl.conf
  ansible.builtin.copy:
    src: wsl.conf
    dest: /etc/wsl.conf
    mode: '0644'
  tags: wsl
  become: true
  when: "ansible_env.WSL_DISTRO_NAME is defined"

- name: Install wslu
  ansible.builtin.apt:
    name: wslu
    state: present
  become: true
  when: "ansible_env.WSL_DISTRO_NAME is defined"

- name: Install Troubleshooting Tools
  block:
    - name: Install hugo
      ansible.builtin.apt:
        deb: https://github.com/gohugoio/hugo/releases/download/v0.147.5/hugo_0.147.5_linux-amd64.deb
        state: present
      become: true
      tags: hugo

    - name: Install watchexec
      ansible.builtin.apt:
        deb: https://github.com/watchexec/watchexec/releases/download/v2.3.2/watchexec-2.3.2-x86_64-unknown-linux-gnu.deb
        state: present
      become: true
      tags: watchexec

    - name: Install curl
      ansible.builtin.apt:
        name: curl
        state: present
      become: true
    
    - name: Install btop
      ansible.builtin.apt:
        name: btop
        state: present
      become: true

    - name: Install lynx
      ansible.builtin.apt:
        name: lynx
        state: present
      become: true

    - name: Install ansible-lint
      ansible.builtin.apt:
        name: ansible-lint
        state: present
      become: true
      tags: ansible

    - name: Install python3
      ansible.builtin.apt:
        name:
          - python3
          - python-is-python3
        state: present
      become: true
      tags: python3

    - name: Install rustup
      ansible.builtin.apt:
        name: rustup
        state: present
      become: true
      tags: rustup
      register: rustup

    - name: Set rustup default to stable
      ansible.builtin.command: rustup default stable
      become: true
      changed_when: true
      when: rustup.changed # noqa: no-handler
      tags: rustup

    - name: Install protobuf-compiler
      ansible.builtin.apt:
        name: protobuf-compiler
        state: present
      become: true
      tags: protobuf-compiler

    - name: Install pre-commit
      ansible.builtin.apt:
        name: pre-commit
        state: present
      become: true
      tags: pre-commit

    - name: Install shellcheck
      ansible.builtin.apt:
        name: shellcheck
        state: present
      become: true
      tags: shellcheck

    - name: Install python3-pip
      ansible.builtin.apt:
        name: python3-pip
        state: present
      become: true
      tags: python3-pip

    - name: Install ansible
      ansible.builtin.apt:
        name: ansible
        state: present
      become: true
      tags: python3

    - name: Install dos2unix
      ansible.builtin.apt:
        name: dos2unix
        state: present
      become: true
      tags: dos2unix

    - name: Install unzip
      ansible.builtin.apt:
        name: unzip
        state: present
      become: true
      tags: unzip

    - name: Install figlet
      ansible.builtin.apt:
        name: figlet
        state: present
      become: true
      tags: figlet

    - name: Install yamllint
      ansible.builtin.apt:
        name: yamllint
        state: present
      become: true
      tags: yamllint

    - name: Create Yamlint config directory
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
        mode: '0755'
      with_items:
        - ~/.config
        - ~/.config/yamllint
      tags: yamllint

    - name: Configure yamllint
      ansible.builtin.copy:
        src: yamllint_config
        dest: ~/.config/yamllint/config
        mode: '0755'
      tags: yamllint

    - name: Create Installers Directories
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
        mode: '0755'
        owner: "{{ ansible_user_id }}"
        group: "{{ ansible_user_id }}"
      with_items:
        - /opt/installers
        - ~/.bashrc.d
        - /opt/installers/lnav
        - /opt/installers/difftastic
        - /opt/installers/awscli
        - /opt/installers/jira
      become: true
      tags: lnav, lazydocker, difftastic, rg, awscli, jira

    - name: Get the aws cli version
      ansible.builtin.command: aws --version
      register: awscli_version
      tags: awscli
      failed_when: false
      changed_when: false

    - name: Legacy aws cli version detected!
      ansible.builtin.debug:
        var: awscli_version.stdout
      tags: awscli
      when: awscli_version is search("aws-cli/1")

    - name: Remove aws cli if installed
      ansible.builtin.pip:
        name: awscli
        state: absent
      tags: awscli
      become: true
      when: awscli_version is search("aws-cli/1")

    - name: Remove /usr/bin/aws
      ansible.builtin.file:
        path: /usr/bin/aws
        state: absent
      become: true
      tags: awscli
      when: awscli_version is search("aws-cli/1")

    - name: Download aws cli
      ansible.builtin.get_url:
        url: "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip"
        dest: /opt/installers/awscli/awscliv2.zip
        force: false
        mode: '0755'
      tags: awscli
      register: awscli_download
      become: true
      when: awscli_version is search("aws-cli/1") or awscli_version.rc == 2

    - name: Download aws cli session manager plugin
      ansible.builtin.get_url:
        url: "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/ubuntu_64bit/session-manager-plugin.deb"
        dest: /opt/installers/awscli/session-manager-plugin.deb
        force: false
        mode: '0755'
      tags: awscli
      become: true
      register: awscli_download

    - name: Extract aws cli
      ansible.builtin.unarchive:
        src: /opt/installers/awscli/awscliv2.zip
        dest: /opt/installers
        remote_src: true
      tags: awscli
      become: true
      when: awscli_version is search("aws-cli/1") or awscli_version.rc == 2

    - name: Remove /usr/bin/aws
      ansible.builtin.file:
        path: /usr/local/aws-cli/v2/current
        state: absent
      become: true
      tags: awscli
      when: awscli_version is search("aws-cli/1")

    - name: Install aws cli
      ansible.builtin.command:
        chdir: /opt/installers/aws
        cmd: sudo ./install
      tags: awscli
      changed_when: true
      when: awscli_version is search("aws-cli/1") or awscli_version.rc == 2

    - name: Create a symbolic link
      ansible.builtin.file:
        src: /usr/local/aws-cli/v2/current/bin/aws
        dest: /usr/bin/aws
        state: link
      become: true
      tags: awscli
      when: awscli_version is search("aws-cli/1") or awscli_version.rc == 2

    - name: Create .aws Directory
      ansible.builtin.file:
        path: ~/.aws
        state: directory
        mode: '0755'
      tags: awscli

    - name: Template aws configuration file
      ansible.builtin.template:
        src: aws_cli_config
        dest: ~/.aws/config
        mode: '0664'
      tags: awscli

    - name: Get the aws cli version
      ansible.builtin.command: aws --version
      register: awscli_version
      tags: awscli
      failed_when: false
      changed_when: false

    - name: Print the awscli version
      ansible.builtin.debug:
        var: awscli_version.stdout
      tags: awscli

    - name: Download Difftastic
      ansible.builtin.get_url:
        url: https://github.com/Wilfred/difftastic/releases/download/0.32.0/difft-x86_64-unknown-linux-gnu.tar.gz
        dest: /opt/installers/difftastic.zip
        validate_certs: false
        mode: '0755'
      tags: difftastic

    - name: Download rg
      ansible.builtin.get_url:
        url: https://github.com/BurntSushi/ripgrep/releases/download/13.0.0/ripgrep-13.0.0-x86_64-unknown-linux-musl.tar.gz
        dest: /opt/installers/rg.tar.gz
        validate_certs: false
        mode: '0755'
      tags: rg

    - name: Extract rg
      ansible.builtin.unarchive:
        src: /opt/installers/rg.tar.gz
        dest: /opt/installers
        remote_src: true
      tags: rg
      become: true

    - name: Install rg
      ansible.builtin.copy:
        src: "/opt/installers/ripgrep-13.0.0-x86_64-unknown-linux-musl/{{ item.src }}"
        dest: "{{ item.dest }}"
        mode: 0755
        remote_src: true
      with_items:
        - {src: 'rg', dest: '/usr/bin/rg'}
      become: true
      tags: rg

    - name: Retreive rg version
      ansible.builtin.command:
        cmd: "rg --version"
      register: rg_version
      tags: rg
      changed_when: false

    - name: Display rg version
      ansible.builtin.debug:
        msg: "rg Installed! for details see https://github.com version is {{ rg_version.stdout }}"
      tags: rg

    - name: Install go
      ansible.builtin.apt:
        name: golang-go
        state: present
      become: true

    - name: Clone fzf repo
      ansible.builtin.git:
        repo: https://github.com/junegunn/fzf.git
        dest: ~/.fzf
        depth: 1
        version: v0.62.0
      tags: fzf
      diff: false

    - name: Download fzf
      ansible.builtin.get_url:
        url: https://github.com/junegunn/fzf/releases/download/v0.62.0/fzf-0.62.0-linux_amd64.tar.gz
        dest: ~/.fzf/fzf.tar.gz
        validate_certs: false
        mode: '0755'
      tags: fzf

    - name: Extract rg
      ansible.builtin.unarchive:
        src: ~/.fzf/fzf.tar.gz
        dest: ~/.fzf/
      tags: rg

    - name: Dowload fzf binary
      ansible.builtin.command:
        chdir: ~/.fzf
        cmd: ./install --bin
      tags: fzf
      register: fzf
      changed_when: fzf.stdout is not search("Already exists")

    - name: Install fzf
      ansible.builtin.copy:
        src: ~/.fzf/bin/fzf
        dest: /usr/bin/fzf
        mode: 0755
      tags: fzf
      become: true

    - name: Install jq
      ansible.builtin.apt:
        name: jq
        state: present
      register: jq
      retries: 5
      until: jq is success
      become: true
      tags: jq

# sudo apt install python3-demjson

    - name: Install ncdu
      ansible.builtin.apt:
        name: ncdu
        state: present
      register: ncdu
      retries: 5
      until: ncdu is success
      become: true
      tags: ncdu

    - name: Install htop
      ansible.builtin.apt:
        name: htop
        state: present
      register: htop
      retries: 5
      until: htop is success
      become: true
      tags: htop

    - name: Retreive eza version
      ansible.builtin.command:
        cmd: "eza --version"
      register: eza_version_before_install
      changed_when: false
      ignore_errors: true
      tags: eza

    - name: Download eza
      ansible.builtin.get_url:
        url: https://github.com/eza-community/eza/releases/download/v0.21.3/eza_x86_64-unknown-linux-gnu.zip
        dest: /opt/installers/eza.zip
        validate_certs: false
        mode: '0755'
      tags: eza
      when: eza_version_before_install.failed

    - name: Extract eza
      ansible.builtin.unarchive:
        remote_src: true
        src: /opt/installers/eza.zip
        dest: /opt/installers
      tags: eza
      when: eza_version_before_install.failed

    - name: Install bat
      ansible.builtin.apt:
        deb: https://github.com/sharkdp/bat/releases/download/v0.25.0/bat_0.25.0_amd64.deb
      become: true

    - name: Install fd
      ansible.builtin.copy:
        src: "/opt/installers/{{ item.src }}"
        dest: "{{ item.dest }}"
        mode: 0755
      with_items:
        - {src: 'eza', dest: '/usr/bin/eza'}
      become: true
      when: eza_version_before_install.failed
      tags: fd

    - name: Retreive fd version
      ansible.builtin.command:
        cmd: "fd --version"
      register: fd_version_before_install
      changed_when: false
      ignore_errors: true
      tags: fd

    - name: Download fd
      ansible.builtin.get_url:
        url: https://github.com/sharkdp/fd/releases/download/v8.3.2/fd-v8.3.2-x86_64-unknown-linux-musl.tar.gz
        dest: /opt/installers/fd.tar.gz
        validate_certs: false
        mode: '0755'
      tags: fd
      when: fd_version_before_install.failed

    - name: Extract fd
      ansible.builtin.unarchive:
        remote_src: true
        src: /opt/installers/fd.tar.gz
        dest: /opt/installers
      tags: fd
      when: fd_version_before_install.failed

    - name: Install fd
      ansible.builtin.copy:
        src: "/opt/installers/fd-v8.3.2-x86_64-unknown-linux-musl/{{ item.src }}"
        dest: "{{ item.dest }}"
        mode: 0755
      with_items:
        - {src: 'fd', dest: '/usr/bin/fd'}
      become: true
      when: fd_version_before_install.failed
      tags: fd

    - name: Install fd autocomplete
      ansible.builtin.copy:
        src: "/opt/installers/fd-v8.3.2-x86_64-unknown-linux-musl/{{ item.src }}"
        dest: "{{ item.dest }}"
        mode: '0755'
      with_items:
        - {src: 'autocomplete/fd.bash', dest: '~/.bashrc.d/fd.bash'}
      tags: fd
      when: fd_version_before_install.failed

    - name: Retreive fd version
      ansible.builtin.command:
        cmd: "fd --version"
      register: fd_version_after_install
      changed_when: false
      tags: fd
      when: fd_version_before_install.failed

    - name: Download wsl2-ssh-agent
      ansible.builtin.get_url:
        url: https://github.com/mame/wsl2-ssh-agent/releases/latest/download/wsl2-ssh-agent
        dest: /usr/bin/wsl2-ssh-agent
        validate_certs: false
        mode: '0755'
      tags: ssh
      become: true
      when: "ansible_env.WSL_DISTRO_NAME is defined"

    - name: Download lnav
      ansible.builtin.get_url:
        url: https://github.com/tstack/lnav/releases/download/v0.10.1/lnav-0.10.1-musl-64bit.zip
        dest: /opt/installers/lnav.tar.gz
        validate_certs: false
        mode: '0755'
      tags: lnav

    - name: Unarchive lnav
      ansible.builtin.unarchive:
        src: /opt/installers/lnav.tar.gz
        dest: /opt/installers/lnav
      tags: lnav
      become: true

    - name: Install lnav
      ansible.builtin.copy:
        src: "/opt/installers/lnav/lnav-0.10.1/{{ item.src }}"
        dest: "{{ item.dest }}"
        mode: 0755
      with_items:
        - {src: 'lnav', dest: '/usr/bin/lnav'}
      become: true
      tags: lnav

    - name: Check lnav version
      ansible.builtin.command:
        cmd: lnav -V
      register: lnav_version
      tags: lnav
      changed_when: false

    - name: Display lnav information
      ansible.builtin.debug:
        msg: "Lnav Log Navigator Installed! for details see https://github.com/tstack/lnav version is {{ lnav_version.stdout }}"
      tags: lnav

    - name: Install cmatrix
      ansible.builtin.apt:
        name: cmatrix
        state: present
      become: true
      tags: cmatrix
      register: cmatrix

- name: Create Bashrc directory
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  with_items:
    - ~/.bashrc.d

- name: Template bashrc configurations
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: '0644'
  with_items:
    - {src: 'bashrc.j2', dest: '~/.bashrc'}
    - {src: 'tmux.bash.j2', dest: '~/.bashrc.d/tmux.bash'}
    - {src: 'eza.bash.j2', dest: '~/.bashrc.d/eza.bash'}
    - {src: 'history.bash.j2', dest: '~/.bashrc.d/history.bash'}
    - {src: 'fzf.bash.j2', dest: '~/.bashrc.d/fzf.bash'}
    - {src: 'ansible.bash.j2', dest: '~/.bashrc.d/ansible.bash'}
    - {src: 'kcat.bash.j2', dest: '~/.bashrc.d/kcat.bash'}
    - {src: 'glow.bash.j2', dest: '~/.bashrc.d/glow.bash'}
    - {src: 'terraform.bash.j2', dest: '~/.bashrc.d/terraform.bash'}
    - {src: 'git.bash.j2', dest: '~/.bashrc.d/git.bash'}
    - {src: 'ssh.bash.j2', dest: '~/.bashrc.d/ssh.bash'}
    - {src: 'aws.bash.j2', dest: '~/.bashrc.d/aws.bash'}
    - {src: 'explorer.bash.j2', dest: '~/.bashrc.d/explorer.bash'}
    - {src: 'vim.bash.j2', dest: '~/.bashrc.d/vim.bash'}
    - {src: 'chrome.bash.j2', dest: '~/.bashrc.d/chrome.bash'}
    - {src: 'wsl.bash.j2', dest: '~/.bashrc.d/wsl.bash'}
    - {src: 'python.bash.j2', dest: '~/.bashrc.d/python.bash'}
    - {src: 'j2lint.bash.j2', dest: '~/.bashrc.d/j2lint.bash'}
    - {src: 'watchexec.bash.j2', dest: '~/.bashrc.d/watchexec.bash'}
    - {src: 'pylintrc.j2', dest: '~/.pylintrc'}
  tags: bashrc

- name: Copy Solventum man in the middle certs
  ansible.builtin.copy:
    src: "{{ item.name }}"
    dest: "/usr/local/share/ca-certificates/{{ item.name }}"
    mode: '0755'
  become: true
  with_items:
    - {name: '3MHEALTH-ROOTCA.crt' }
    - {name: '3MHealth-CA01.crt' }
    - {name: '3MHealth-CA02.crt' }
  tags: mitm_certs
  register: mitm_certs
  when: ansible_env.NAME != 'scottthinkpad'

- name: Update certificate store
  ansible.builtin.command: sudo update-ca-certificates
  become: true
  changed_when: true
  when: mitm_certs.changed # noqa: no-handler
  tags: mitm_certs

- name: Template tmux configuration
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: '0755'
  with_items:
    - {src: 'tmux.conf.j2', dest: '~/.tmux.conf'}

- name: Create vim plugin directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  with_items:
    - ~/.vim/pack/git-plugins/start
    - ~/.vim/pack/git-plugins/start/ale
    - ~/.vim/pack/git-plugins/start/ansible-vim
    - ~/.vim/pack/git-plugins/start/indentline
  tags: vim

- name: Clone ale plugin repo
  ansible.builtin.git:
    repo: https://github.com/dense-analysis/ale.git
    dest: ~/.vim/pack/git-plugins/start/ale
    version: HEAD # noqa: latest
  tags: vim
  diff: false

- name: Clone ansible-vim plugin repo
  ansible.builtin.git:
    repo: https://github.com/pearofducks/ansible-vim
    dest: ~/.vim/pack/git-plugins/start/ansible-vim
    version: HEAD # noqa: latest
  tags: vim
  diff: false

- name: Clone Indentline repo
  ansible.builtin.git:
    repo: https://github.com/Yggdroot/indentLine.git
    dest: ~/.vim/pack/git-plugins/start/indentline
    version: HEAD # noqa: latest
  tags: vim
  diff: false

- name: Template vimrc
  ansible.builtin.template:
    src: vimrc.j2
    dest: ~/.vimrc
    mode: '0755'
  tags: vim

- name: Ensure hushlogin is created for current user
  ansible.builtin.file:
    path: ~/.hushlogin
    state: file
  tags: hushlogin
  when: "ansible_env.WSL_DISTRO_NAME"

- name: Ensure hushlogin is created for root
  ansible.builtin.file:
    path: /root/.hushlogin
    state: file
  become: true
  tags: hushlogin
  when: "ansible_env.WSL_DISTRO_NAME"

# https://askubuntu.com/questions/334318/sudoers-file-enable-nopasswd-for-user-all-commands
# %sudo  ALL=(ALL) NOPASSWD: ALL
- name: Change sudo group to not require password
  community.general.sudoers:
    name: sudo
    group: sudo
    state: present
    commands: ALL
    nopassword: true
    validation: required
  become: true
  tags: sudoers

- name: Copy aptcron script to root user home directory
  ansible.builtin.copy:
    src: aptcron.bash
    dest: /root/aptcron.bash
    mode: '775'
  tags: apt
  become: true

- name: Patch system at noon
  ansible.builtin.cron:
    minute: "0"
    hour: "12"
    name: Patch at noon
    user: root
    job: "/root/aptcron.bash"
  become: true
  tags: apt

- name: Patch system on Reboot
  ansible.builtin.cron:
    special_time: reboot
    name: Patching on system start
    user: root
    job: "/root/aptcron.bash"
  become: true
  tags: apt

- name: Copy using inline content
  ansible.builtin.copy:
    content: |
      # instructions on how to use the systemd syslog
      # grep CRON /var/log/syslog
    dest: /var/log/cron
    mode: '0644'
  tags: cron
  become: true

- name: Install postfix for cron messages
  ansible.builtin.apt:
    name: postfix
    state: present
  become: true
  tags: postfix
  register: postfix_install

# roles/install_prerequisites/templates/postfix_main.cf.j2

- name: Configure alaises with postalias command
  ansible.builtin.command:
    cmd: postalias /etc/aliases
    creates: /etc/aliases
  become: true
  tags: postfix
  when: postfix_install.changed # noqa: no-handler

- name: Configure alias_maps
  ansible.builtin.command:
    cmd: postconf alias_maps
    creates: /etc/aliases.db
  become: true
  tags: postfix
  when: postfix_install.changed # noqa: no-handler

- name: Download jira cli
  ansible.builtin.get_url:
    url: https://github.com/ankitpokhrel/jira-cli/releases/download/v1.6.0/jira_1.6.0_linux_x86_64.tar.gz
    dest: /opt/installers/jira.tar.gz
    validate_certs: false
    mode: '0755'
  tags: jira

- name: Unarchive jira cli
  ansible.builtin.unarchive:
    src: /opt/installers/jira.tar.gz
    dest: /opt/installers/jira
  become: true
  tags: jira

- name: Install Jira CLI
  ansible.builtin.copy:
    src: "/opt/installers/jira/jira_1.6.0_linux_x86_64/bin/{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: 0755
  with_items:
    - {src: 'jira', dest: '/usr/bin/jira'}
  become: true
  tags: jira
# /home/sbennett/.config/.jira/.config.yml
# C:\Users\AAA3AZZ/.config/.jira/.config.yml

- name: Install ncurses-dev for Tig
  ansible.builtin.apt:
    name: ncurses-dev
    state: present
  become: true
  tags: tig

- name: Download tig
  ansible.builtin.get_url:
    url: https://github.com/jonas/tig/releases/download/tig-2.5.12/tig-2.5.12.tar.gz
    dest: /opt/installers/tig.tar.gz
    validate_certs: false
    mode: '0755'
  tags: tig

- name: Extract tig
  ansible.builtin.unarchive:
    src: /opt/installers/tig.tar.gz
    dest: /opt/installers
    remote_src: true
    creates: /opt/installers/tig-2.5.12
  tags: tig

- name: Configure Tig
  ansible.builtin.command:
    cmd: ./configure
    chdir: /opt/installers/tig-2.5.12/
    creates: /opt/installers/tig-2.5.12/config.status
  become: true
  tags: tig

- name: Make Tig
  ansible.builtin.command:
    cmd: make
    chdir: /opt/installers/tig-2.5.12/
    creates: /opt/installers/tig-2.5.12/src/tig
  become: true
  tags: tig

- name: Install Tig
  ansible.builtin.command:
    cmd: sudo make install
    chdir: /opt/installers/tig-2.5.12/
    creates: /usr/local/bin/tig
  become: true
  tags: tig

- name: Confirm that tig runs https://jonas.github.io/tig
  ansible.builtin.command:
    cmd: tig --version
  tags: tig
  changed_when: false
  register: tig_version

- name: Print the verson
  ansible.builtin.debug:
    var: tig_version.stdout
  tags: tig

- name: Install python3-full
  ansible.builtin.apt:
    name: python3-full
    state: present
  become: true
  tags: python

- name: Install pipx
  ansible.builtin.apt:
    name: pipx
    state: present
  become: true
  tags: python

- name: Install j2lint
  community.general.pipx:
    name: j2lint
  tags: python

- name: Install pylint
  community.general.pipx:
    name: pylint
  tags: python

- name: Install visidata
  community.general.pipx:
    name: visidata
  tags: python

- name: Install termdown
  community.general.pipx:
    name: termdown
  tags: python

- name: Template Ubuntu Pro configuration file
  ansible.builtin.template:
    src: ubuntu_pro__uaclient.conf.j2
    dest: /etc/ubuntu-advantage/uaclient.conf
    mode: '0644'
  tags: ubuntu_advantage
  become: true
  register: ubuntu_advantage

- name: Turn off Ubuntu Pro apt news
  ansible.builtin.command: "sudo pro config set apt_news=false"
  become: true
  changed_when: true
  tags: ubuntu_advantage
  when: ubuntu_advantage.changed # noqa: no-handler

- name: Refresh Ubuntu pro configuration
  ansible.builtin.command: sudo pro refresh config
  become: true
  changed_when: true
  tags: ubuntu_advantage
  when: ubuntu_advantage.changed # noqa: no-handler

- name: Copy using inline content
  ansible.builtin.copy:
    content: ''
    dest: /etc/apt/apt.conf.d/20apt-esm-hook.conf
    mode: '0644'
  become: true
  tags: ubuntu_advantage

- name: Template selected editor file
  ansible.builtin.template:
    src: selected_editor.j2
    dest: ~/.selected_editor
    mode: '0644'

- name: Template selected editor file
  ansible.builtin.template:
    src: selected_editor.j2
    dest: ~/.selected_editor
    mode: '0644'
  become: true

- name: Template git update cron script
  ansible.builtin.template:
    src: git_update.bash
    dest: "{{ playbook_dir }}/../git_update.bash"
    mode: '0755'
  tags: git_update

- name: Update Repos at Noon
  ansible.builtin.cron:
    minute: "0"
    hour: "12"
    name: Update Repos at Noon
    job: "{{ playbook_dir }}/../git_update.bash"
  tags: git_update

- name: Patch system on Reboot
  ansible.builtin.cron:
    special_time: reboot
    name: Update repos at Reboot
    job: "{{ playbook_dir }}/../git_update.bash"
  tags: git_update

- name: Remove shiftkey-packages
  ansible.builtin.file:
    path: /etc/apt/sources.list.d/shiftkey-packages.list
    state: absent

- name: Install bind9-dnsutils
  ansible.builtin.apt:
    name: bind9-dnsutils
    state: present
  become: true

# pipx install sncli
# cp .snclirc ~/.snclirc
# movify to have a good location for temp files in linux

# alias sn sncli
# alias simplenote sncli
